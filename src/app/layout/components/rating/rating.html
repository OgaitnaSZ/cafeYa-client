<!-- rating.component.html -->
<div 
  class="fixed inset-0 bg-black/50 z-50 flex items-end"
  (click)="closeModal()"
>
  <div 
    class="
      bg-white
      rounded-t-3xl
      w-full
      max-h-[90vh]
      overflow-y-auto
      pb-safe-bottom
      animate-slide-up
    "
    (click)="onContentClick($event)"
  >
    <!-- Handle -->
    <div class="flex justify-center pt-3 pb-2">
      <div class="w-12 h-1 bg-gray-300 rounded-full"></div>
    </div>

    <!-- Botón cerrar -->
    <button
      (click)="closeModal()"
      class="
        absolute top-4 right-4
        w-8 h-8
        bg-gray-100 hover:bg-gray-200
        rounded-full
        flex items-center justify-center
        z-10
        transition
      "
    >
      <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>

    <!-- CONTENIDO -->
    @if(!showSuccess()) {
      <div class="px-6 py-6">
        <!-- Header -->
        <div class="text-center mb-6">
          <h2 class="text-2xl font-bold text-gray-900 mb-1">
            Calificar Pedido
          </h2>
          <p class="text-sm text-gray-600">
            Pedido #{{ pedido.numero_pedido }}
          </p>
        </div>

        <!-- Estrellas de calificación -->
        <div class="bg-gray-50 rounded-2xl p-6 mb-6">
          <p class="text-center text-gray-900 font-semibold mb-4">
            ¿Cómo estuvo todo?
          </p>

          <!-- Rating interactivo -->
          <div class="flex justify-center gap-2 mb-3">
            @for(star of [1,2,3,4,5]; track star) {
              <button
                (click)="setRating(star)"
                (mouseenter)="setHoverRating(star)"
                (mouseleave)="clearHoverRating()"
                class="
                  w-12 h-12
                  flex items-center justify-center
                  transition-transform
                  active:scale-90
                "
              >
                <svg 
                  class="w-10 h-10 transition-colors"
                  [class.fill-amber-400]="star <= getRatingDisplay()"
                  [class.fill-gray-200]="star > getRatingDisplay()"
                  viewBox="0 0 20 20"
                >
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
              </button>
            }
          </div>

          <!-- Texto de puntuación -->
          <p class="text-center text-sm font-medium">
            @if(puntuacion() === 0) {
              <span class="text-gray-500">Tocá las estrellas para calificar</span>
            } @else if(puntuacion() === 1) {
              <span class="text-red-600">Muy malo</span>
            } @else if(puntuacion() === 2) {
              <span class="text-orange-600">Malo</span>
            } @else if(puntuacion() === 3) {
              <span class="text-yellow-600">Regular</span>
            } @else if(puntuacion() === 4) {
              <span class="text-lime-600">Bueno</span>
            } @else if(puntuacion() === 5) {
              <span class="text-green-600">Excelente</span>
            }
          </p>
        </div>

        <!-- Comentario -->
        <div class="mb-6">
          <label class="block text-sm font-semibold text-gray-900 mb-2">
            Contanos tu experiencia
          </label>
          <textarea
            [(ngModel)]="resena"
            placeholder="¿Qué te pareció el servicio y la comida?"
            rows="4"
            maxlength="500"
            class="
              w-full
              px-4 py-3
              text-sm
              bg-gray-50
              border border-gray-200
              rounded-xl
              focus:border-orange-500 focus:bg-white focus:outline-none
              resize-none
              transition
            "
          ></textarea>
          <p class="text-xs text-gray-500 mt-1.5 text-right">
            {{ resena().length }}/500
          </p>
        </div>

        <!-- Botones -->
        <div class="flex gap-3">
          <button
            (click)="closeModal()"
            class="
              flex-1 h-12
              bg-gray-100 text-gray-700
              font-bold
              rounded-xl
              active:bg-gray-200
              transition
            "
          >
            Cancelar
          </button>

          <button
            [disabled]="puntuacion() === 0 || !resena().trim() || isSubmitting()"
            (click)="submitRating()"
            class="
              flex-[2] h-12
              bg-gradient-to-r from-amber-500 to-yellow-500
              text-white font-bold
              rounded-xl
              shadow-lg shadow-amber-500/30
              disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed
              active:scale-95
              transition-all
              flex items-center justify-center gap-2
            "
          >
            @if(isSubmitting()) {
              <div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
              <span>Enviando...</span>
            } @else {
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
              </svg>
              <span>Enviar</span>
            }
          </button>
        </div>
      </div>
    }

    <!-- PANTALLA DE ÉXITO -->
    @if(showSuccess()) {
      <div class="px-6 py-12 text-center">
        <!-- Ícono de éxito -->
        <div class="
          w-20 h-20
          bg-green-100
          rounded-full
          flex items-center justify-center
          mx-auto
          mb-4
        ">
          <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
        </div>

        <h3 class="text-xl font-bold text-gray-900 mb-2">
          ¡Gracias por tu calificación!
        </h3>

        <p class="text-gray-600 text-sm">
          Tu opinión nos ayuda a mejorar cada día
        </p>
      </div>
    }
  </div>
</div>