<div class="h-full flex flex-col bg-linear-to-b from-orange-50 to-white">
  
  <!-- HEADER -->
  <header class="
    h-14
    pt-safe-top
    px-4
    flex items-center
    border-b border-gray-100
  ">
    <h1 class="flex-1 text-center text-lg font-semibold text-gray-900">
      Validar mesa
    </h1>
  </header>

  <!-- CONTENIDO PRINCIPAL -->
  <div class="flex-1 overflow-y-auto px-4 pt-8 pb-6">
    <div class="max-w-md mx-auto">
      
      <!-- Hero -->
      @if(invalidIdError){
        <!-- √çcono error -->
        <div class="
          w-20 h-20
          mx-auto mb-6
          bg-red-100
          rounded-full
          flex items-center justify-center
        ">
          <lucide-icon [img]="AlertCircle" class="w-10 h-10 text-red-600" ></lucide-icon>
        </div>

        <!-- T√≠tulo -->
        <h2 class="text-2xl font-bold text-center text-gray-900 mb-2">
          Oops, algo sali√≥ mal
        </h2>
        
        <p class="text-center text-gray-600 mb-8">
          {{ error() }}
        </p>
      } @else {
        <!-- √çcono de √©xito (QR escaneado) -->
        <div class="
          w-20 h-20
          mx-auto mb-6
          bg-green-100
          rounded-full
          flex items-center justify-center
        ">
          <lucide-icon 
            [img]="CheckCircle2" 
            class="w-10 h-10 text-green-600"
          ></lucide-icon>
        </div>

        <!-- T√≠tulo -->
        <h2 class="text-2xl font-bold text-center text-gray-900 mb-2">
          ¬°QR escaneado!
        </h2>
        
        <p class="text-center text-gray-600 mb-8">
          Ahora ingres√° el c√≥digo de tu mesa para continuar
        </p>
        <!-- CARD DE MESA -->
        <div class="
          bg-white
          rounded-2xl
          p-6
          shadow-lg
          border-2 border-orange-200
          mb-6
        ">
          <!-- N√∫mero de mesa -->
          <div class="text-center mb-6">
            <p class="text-sm text-gray-500 mb-2">
              N√∫mero de mesa
            </p>
            <div class="
              inline-flex items-center justify-center
              w-20 h-20
              bg-linear-to-br from-orange-500 to-red-500
              text-white
              rounded-2xl
              shadow-lg
            ">
              <span class="text-4xl font-bold">
                {{ mesaDetails()?.numero || '??' }}
              </span>
            </div>
          </div>
          
          <!-- Separador -->
          <div class="border-t border-gray-200 mb-6"></div>
          
          <!-- Input de c√≥digo -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              C√≥digo de validaci√≥n
            </label>
            
            <!-- C√≥digo PIN de 4 d√≠gitos -->
            <div class="flex gap-3 justify-center mb-2">
              <input
                #digit1
                type="text"
                inputmode="numeric"
                maxlength="1"
                (input)="onDigitInput($event, 1)"
                (keydown)="onKeyDown($event, 0)"
                class="
                  w-14 h-16
                  text-center text-2xl font-bold
                  bg-gray-50
                  border-2 border-gray-300
                  rounded-xl
                  focus:border-orange-500 focus:bg-white
                  focus:outline-none
                  transition
                "
              />
              <input
                #digit2
                type="text"
                inputmode="numeric"
                maxlength="1"
  
                (input)="onDigitInput($event, 2)"
                (keydown)="onKeyDown($event, 1)"
                class="
                  w-14 h-16
                  text-center text-2xl font-bold
                  bg-gray-50
                  border-2 border-gray-300
                  rounded-xl
                  focus:border-orange-500 focus:bg-white
                  focus:outline-none
                  transition
                "
              />
              <input
                #digit3
                type="text"
                inputmode="numeric"
                maxlength="1"
  
                (input)="onDigitInput($event, 3)"
                (keydown)="onKeyDown($event, 2)"
                class="
                  w-14 h-16
                  text-center text-2xl font-bold
                  bg-gray-50
                  border-2 border-gray-300
                  rounded-xl
                  focus:border-orange-500 focus:bg-white
                  focus:outline-none
                  transition
                "
              />
              <input
                #digit4
                type="text"
                inputmode="numeric"
                maxlength="1"
  
                (input)="onDigitInput($event, 4)"
                (keydown)="onKeyDown($event, 3)"
                class="
                  w-14 h-16
                  text-center text-2xl font-bold
                  bg-gray-50
                  border-2 border-gray-300
                  rounded-xl
                  focus:border-orange-500 focus:bg-white
                  focus:outline-none
                  transition
                "
              />
            </div>
            
            <!-- Hint -->
            <p class="text-xs text-gray-500 text-center">
              El c√≥digo est√° visible en la mesa
            </p>
            
            <!-- Error message -->
            @if(error()){
              <div 
                class="
                  mt-4
                  p-3
                  bg-red-50
                  border border-red-200
                  rounded-xl
                  flex items-start gap-2
                "
              >
                <lucide-icon [img]="AlertCircle" class="w-5 h-5 text-red-500 shrink-0 mt-0.5" ></lucide-icon>
                <p class="text-sm text-red-700">
                  {{ error() }}
                </p>
              </div>
            }
          </div>
        </div>
        
        <!-- Bot√≥n de validaci√≥n -->
        <button
          [disabled]="!isCodeComplete()"
          (click)="validateCode()"
          class="
            w-full h-14
            bg-linear-to-r from-orange-500 to-red-500
            text-white text-lg font-bold
            rounded-xl
            shadow-lg shadow-orange-500/30
            disabled:opacity-50 disabled:shadow-none
            active:scale-95
            transition-all
            flex items-center justify-center gap-2
          "
        >
          @if (!loading()){
            <span>Validar y continuar</span>
          }
          
          <!-- Loading state -->
          @if(loading()){
            <div class="flex items-center gap-2">
              <div class="
                w-5 h-5
                border-2 border-white border-t-transparent
                rounded-full
                animate-spin
              "></div>
              <span>Validando...</span>
            </div>
          }
        </button>
        
        <!-- Ayuda adicional -->
        <div class="mt-6 text-center">
          <button 
            (click)="showHelpModal = true"
            class="text-sm text-gray-600 underline"
          >
            ¬øNo encontr√°s el c√≥digo?
          </button>
        </div>
      }
    </div>
  </div>
</div>

<!-- MODAL DE AYUDA -->
@if(showHelpModal){
  <div 
    class="fixed inset-0 bg-black/70 flex items-end sm:items-center justify-center z-50"
    (click)="showHelpModal = false"
  >
    <div 
      class="
        bg-white 
        rounded-t-3xl sm:rounded-2xl 
        p-6 
        w-full sm:max-w-md
        pb-safe-bottom
      "
      (click)="$event.stopPropagation()"
    >
      <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-6 sm:hidden"></div>
      
      <h3 class="text-xl font-bold mb-4">¬øD√≥nde est√° el c√≥digo?</h3>
      
      <div class="space-y-4 mb-6">
        <!-- Ilustraci√≥n o imagen -->
        <div class="
          w-full h-40
          bg-orange-100
          rounded-xl
          flex items-center justify-center
          text-6xl
        ">
          üî¢
        </div>
        
        <div class="space-y-3 text-sm text-gray-700">
          <p class="flex items-start gap-2">
            <span class="text-orange-500 font-bold">‚Ä¢</span>
            <span>El c√≥digo est√° en un cartel en tu mesa, generalmente cerca del QR</span>
          </p>
          <p class="flex items-start gap-2">
            <span class="text-orange-500 font-bold">‚Ä¢</span>
            <span>Son 4 n√∫meros que cambian cada vez que se ocupa la mesa</span>
          </p>
          <p class="flex items-start gap-2">
            <span class="text-orange-500 font-bold">‚Ä¢</span>
            <span>Si no lo ves, pedile ayuda al mozo</span>
          </p>
        </div>
      </div>
      
      <button 
        (click)="showHelpModal = false"
        class="
          w-full h-12
          bg-orange-500 text-white
          rounded-xl
          font-semibold
          active:bg-orange-600
        "
      >
        Entendido
      </button>
    </div>
  </div>
}