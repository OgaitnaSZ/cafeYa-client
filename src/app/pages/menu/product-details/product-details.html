<app-bottom-sheet 
  [isOpen]="isOpen()"
  (close)="closeProductDetail()"
>
  <!-- Imagen grande -->
  @if (selectedProduct().imagen_url) {
    <figure class="h-64 w-full">
      <img 
        [src]="selectedProduct().imagen_url" 
        [alt]="selectedProduct().nombre"
        class="w-full h-full aspect-square object-cover cursor-pointer"
      />
    </figure>
  } @else {
    <div class="
      w-full h-64
      bg-linear-to-br from-orange-100 to-amber-100
      flex items-center justify-center
      text-8xl
    ">
      üçΩÔ∏è
    </div>
  }
  
  <!-- Contenido -->
  <div class="px-6 py-6">
    <!-- Badge de disponibilidad y categor√≠a -->
    <div class="flex items-center gap-2 mb-3">
      @if(selectedProduct().stock > 1) {
        <span class="px-3 py-1 bg-green-100 text-green-700 text-xs font-semibold rounded-full">
          ‚úì Disponible
        </span>
      } @else {
        <span class="px-3 py-1 bg-red-100 text-red-700 text-xs font-semibold rounded-full">
          ‚úó No disponible
        </span>
      }
      
      @if(categoria()) {
        <span class="px-3 py-1 bg-gray-100 text-gray-700 text-xs font-semibold rounded-full">
          {{ categoria()?.emoji }} {{ categoria()?.nombre }}
        </span>
      }
    </div>
    
    <!-- Nombre -->
    <h2 class="text-2xl font-bold text-gray-900 mb-2">
      {{ selectedProduct().nombre }}
    </h2>
    
    <!-- Descripci√≥n -->
    <p class="text-gray-600 mb-4 leading-relaxed">
      {{ selectedProduct().descripcion }}
    </p>
    
    <!-- Precio -->
    <div class="flex items-baseline gap-2 mb-6">
      <span class="text-3xl font-bold text-orange-600">
        ${{ selectedProduct().precio_unitario | number }}
      </span>
      <span class="text-sm text-gray-500">
        precio unitario
      </span>
    </div>
    
    <!-- Cantidad -->
    <div class="mb-6">
      <label class="block text-sm font-semibold text-gray-700 mb-3">
        Cantidad
      </label>
      <div class="flex items-center gap-4">
        <button
          (click)="decreaseQuantity()"
          [disabled]="modalQuantity() <= 1"
          class="
            w-12 h-12
            bg-gray-100 text-gray-700
            rounded-xl
            flex items-center justify-center
            active:bg-gray-200
            disabled:opacity-30 disabled:cursor-not-allowed
            transition
          "
        >
          <lucide-icon [img]="Minus" class="w-5 h-5" stroke="currentColor"></lucide-icon>
        </button>
        
        <span class="text-2xl font-bold text-gray-900 min-w-10 text-center">
          {{ modalQuantity() }}
        </span>
        
        <button
          (click)="increaseQuantity()"
          class="
            w-12 h-12
            bg-orange-100 text-orange-600
            rounded-xl
            flex items-center justify-center
            active:bg-orange-200
            transition
          "
        >
          <lucide-icon [img]="Plus" class="w-5 h-5" stroke="currentColor"></lucide-icon>
        </button>
      </div>
    </div>
    
    <!-- Notas especiales -->
    <div class="mb-6">
      <label class="block text-sm font-semibold text-gray-700 mb-2">
        Notas especiales (opcional)
      </label>
      <textarea
        [(ngModel)]="modalNotes"
        [maxlength]="100"
        [class.border-orange-500]="modalNotes().length >= 90"
        placeholder="Ej: Sin az√∫car, extra caliente..."
        rows="3"
        maxlength="100"
        class="
          w-full
          px-4 py-3
          text-sm
          bg-gray-50
          border border-gray-200
          rounded-xl
          focus:border-orange-500 focus:bg-white focus:outline-none
          resize-none
          transition
        "
      ></textarea>
      <div class="flex justify-between items-center mt-1">
        <p class="text-xs text-gray-500">
          M√°ximo 100 caracteres
        </p>
        <p class="text-xs text-gray-400">
          {{ modalNotes().length }}/100
        </p>
      </div>
    </div>
    
    <!-- Botones de acci√≥n -->
    <div class="flex gap-3">
      <button
        (click)="closeProductDetail()"
        class="
          flex-1 h-14
          bg-gray-100 text-gray-700
          text-base font-bold
          rounded-xl
          active:bg-gray-200
          transition
        "
      >
        Cancelar
      </button>
      
      <button
        [disabled]="selectedProduct().stock < 1"
        (click)="addToCartFromModal()"
        class="
          flex-2 h-14
          bg-linear-to-r from-orange-500 to-red-500
          text-white text-base font-bold
          rounded-xl
          shadow-lg shadow-orange-500/30
          active:scale-95
          disabled:opacity-50 disabled:shadow-none disabled:cursor-not-allowed
          transition-all
          flex items-center justify-center gap-2
        "
      >
        <lucide-icon [img]="ShoppingCart" class="w-5 h-5" stroke="currentColor"></lucide-icon>
        Agregar ${{ modalTotal() | number }}
      </button>
    </div>
  </div>
</app-bottom-sheet>