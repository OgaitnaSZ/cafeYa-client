<!-- scan.component.html -->
<div class="h-full flex flex-col bg-gray-900">
  
  <!-- HEADER -->
  <header class="
    h-14
    pt-safe-top
    px-4
    flex items-center justify-between
    bg-gray-900
    relative z-10
  ">
    <button 
      (click)="goBack()"
      class="
        w-10 h-10
        flex items-center justify-center
        text-white
        rounded-full
        active:bg-white/10
      "
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
    </button>
    
    <h1 class="text-lg font-semibold text-white">
      Escanear QR
    </h1>
    
    <!-- Botón de ayuda -->
    <button 
      (click)="showHelp()"
      class="
        w-10 h-10
        flex items-center justify-center
        text-white
        rounded-full
        active:bg-white/10
      "
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
    </button>
  </header>

  <!-- ÁREA DE LA CÁMARA -->
  <div class="flex-1 relative overflow-hidden">
    
    <!-- Video stream de la cámara -->
    <video 
      #videoElement
      class="absolute inset-0 w-full h-full object-cover"
      autoplay
      playsinline
    ></video>
    
    <!-- Overlay con marco de escaneo -->
    <div class="absolute inset-0 flex items-center justify-center">
      <!-- Overlay oscuro con recorte -->
      <div class="absolute inset-0 bg-black/60"></div>
      
      <!-- Marco de escaneo -->
      <div class="relative z-10 flex flex-col justify-center items-center">
        <!-- Área transparente para el QR -->
        <div class="
          w-64 h-64
          border-4 border-white
          rounded-3xl
          relative
          shadow-2xl
        ">
          <!-- Esquinas animadas -->
          <div class="absolute -top-1 -left-1 w-8 h-8 border-t-4 border-l-4 border-orange-500 rounded-tl-3xl"></div>
          <div class="absolute -top-1 -right-1 w-8 h-8 border-t-4 border-r-4 border-orange-500 rounded-tr-3xl"></div>
          <div class="absolute -bottom-1 -left-1 w-8 h-8 border-b-4 border-l-4 border-orange-500 rounded-bl-3xl"></div>
          <div class="absolute -bottom-1 -right-1 w-8 h-8 border-b-4 border-r-4 border-orange-500 rounded-br-3xl"></div>
          
          <!-- Línea de escaneo animada -->
          <div class="
            absolute inset-x-0 top-0
            h-1 bg-orange-500
            animate-scan
          "></div>
        </div>
        
        <!-- Instrucción -->
        <div class="
          mt-8
          text-center
          text-white
          px-4
        ">
          <p class="text-lg font-semibold mb-2">
            Apuntá al código QR de tu mesa
          </p>
          <p class="text-sm text-gray-300">
            Centrado en el recuadro
          </p>
        </div>
      </div>
    </div>
    
    <!-- Estado de procesamiento -->
    @if(isProcessing){
        <div 
        class="
            absolute inset-0
            bg-black/80
            flex flex-col items-center justify-center
            z-20
        "
        >
            <div class="
                w-16 h-16
                border-4 border-orange-500 border-t-transparent
                rounded-full
                animate-spin
                mb-4
            "></div>
            <p class="text-white font-medium">
                Procesando código...
            </p>
            </div>
        }
    </div>
</div>

<!-- MODAL DE AYUDA -->
@if(showHelpModal){
    <div 
      class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 px-4"
      (click)="closeHelp()"
    >
      <div 
        class="bg-white rounded-2xl p-6 max-w-sm w-full"
        (click)="$event.stopPropagation()"
      >
        <h3 class="text-xl font-bold mb-4">¿Cómo escanear?</h3>
        
        <div class="space-y-3 text-sm text-gray-700 mb-6">
          <p>1. Buscá el código QR en tu mesa (generalmente está en un cartel o sticker)</p>
          <p>2. Centrálo en el recuadro blanco</p>
          <p>3. Mantené el celular firme hasta que se detecte</p>
          <p>4. Si no funciona, probá con más luz o ingresá el código manualmente</p>
        </div>
        
        <button 
          (click)="closeHelp()"
          class="
            w-full h-12
            bg-orange-500 text-white
            rounded-xl
            font-semibold
            active:bg-orange-600
          "
        >
          Entendido
        </button>
      </div>
    </div>
}